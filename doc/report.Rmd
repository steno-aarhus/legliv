---
title: "Substitution of red meat with legumes and risk of primary liver cancer in 126,744 UK Biobank participants: a prospective cohort study"
author:
- name: Niels Bock
  orcid: 0009-0005-7373-1589
  affiliations:
  - name: Department of Public Health, Aarhus University, Aarhus, Denmark
date: "`r Sys.Date()`"
csl: diabetologia.csl
format: html
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
targets::tar_config_set(store = here::here("_targets"))
data <- targets::tar_read(data_cleaned)
data_hcc <- targets::tar_read(data_with_hcc)
data_icc <- targets::tar_read(data_with_icc)
data_alc <- targets::tar_read(data_with_alc)
data_misreporter <- targets::tar_read(data_with_misreporter)
data_3_ques_comp <- targets::tar_read(data_with_3_ques_comp)
library(flextable)
library(gt)
library(gtsummary)
library(tidyverse)
library(survival)
```

# Abstract

Objective:

Research Design and Methods:

Results:

Conclusions:

# Introduction

# Research Design and Methods

**Study population**

The UK Biobank, a population-based prospective cohort, wasinitiated in
2006. [@sudlow2015] During 2006-2010, more than 500,000 participants,
aged 40-69, were recruited and visited designated assessment centres
across the UK Participants provided information about age, sex,
sociodemographic factors (education, Townsend deprivation index, living
alone) and lifestyle factors (smoking, alcohol consumption, physical
activity) via touch screen questionnaires and computer-assisted
interviews. Anthropometric data (BMI, waist circumference) were
collected via physical measurements (reference to UKB document here).

**Dietary assessment**

A web-based 24-hour dietary recall was administered at the end of the
initial assessment visit for the last 70,000 recruited participants
(reference from UKB document here). From February 2011 to April 2012,
320,000 participants who had provided an e-mail address were invited on
four separate occasions to complete the 24-hour dietary recall, the
Oxford WebQ, of which 210,947 participants completed at least one. The
Oxford WebQ covered 206 food items and 32 beverage items commonly
consumed in the UK. Intakes were reported in standard units of
measurements, e.g., servings, cups, slices, etc. with intake categories
ranging from 0 to 3+ units [@piernas2021]. The Oxford WebQ has been
validated againts interviewer-based 24-hour dietary recalls and
biomarkers [@Liu2011; @Greenwood2019].

Researchers defined79 food groups and 14 beverage groups from the Oxford
WebQ using the UK National Diet and Nutrition Survey categories
[@piernas2021]. These food and beverage groups were used when defining
the food groups used in the substitution analyses (Supplementary Table
1). Legumes were defined as dietary pulses, baked beans, tofu-based
products, peas, hummus, soy drinks, and soy-based desserts and yogurt.
Red meat intake was defined as intake of beef, pork, lamb, or other
meat, including offal. Processed meat intake was defined as sausages,
bacon (with and without fat), ham, or liver pate. Other food groups
included were animal-based foods, unhealthy plant-based foods, healthy
plant-based foods, and alcoholic beverages (Supplementary Table 1).
Animal-based and healthy and unhealthy plant-based food foods were
grouped based on plant-based diet indices from previous studies
[@Thompson2023; @Heianza2021; @Satija2017; @Satija2016]. An overview of
included foods in each food group is displayed in Supplementary Table 1.

Due to the incapability of a single 24-hour dietary recall to properly
assess habitual dietary intake and variation in diet over time
[@thompson2013; @gurinovic2017], only participants who completed two or
more Oxford WebQs were eligible for inclusion in this study.

**Liver cancer assessment**

Liver cancer was defined according to ICD-10 diagnosis codes C22.0 for
Hepatocellular carcinoma (HCC) or C22.1 for Intrahepatic
cholangiocarcinoma (ICC). Incident and prevalent cases of liver cancer
and corresponding diagnosis dates were obtained via linkage to central
cancer registries or hospital inpatient episodes [@sudlow2015].

**Assessment of confounders**

Confounders were defined *a priori* from a literature review of the
background literature and illustrated using directed acyclic graphs
(Supplementary Figure 1). The following confounding variables were
selected: age at baseline (years, continuous), sex (male, female),
educational level (high: College or University degree, intermediate: A
levels/AS levels, O levels/GCSEs, or equivalent, low: none of the
previous mentioned), Townsend Deprivation Index (continuous), Living
alone (yes, no), waist circumference (cm, continuous), physical activity
(above/below the 2017 UK Physical activity guidelines of 150 minutes of
moderate activity per week or 75 minutes of vigorous activity, or
unknown), smoking (pack years as a proportion of lifespan exposed to
smoking, continous), and alcohol intake (g/day, continuous). All
confounders except age were selected from the initial assessment visit
before the start of follow-up.

**The substitution model**

The substitution analyses were conducted by replacing an equal mass of
meat with legumes. The size of the substitution was set to 15 g of
legumes for 15 g of meat to keep the substitution size below the mean
intake of any of the substituted food groups in the cohort. The
substitutions were modelled using the leave-one-out-approach in which
variables for every food group along with a variable for total food
intake are included, except the food group that are to be substituted
[@Ibsen2021]. To estimate substitution of 15 grams of all red meats (red
and processed) with 15 grams of legumes, the following model was
defined:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Total food intake (g) + \beta_3 Other food groups(g) + \beta_4 Covariates
$$

When substituting only red meat with legumes, processed meat was added
to the model:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Processed meat (15g) + \beta_3 Total food intake (g) + \beta_4 Other food groups(g) + \beta_5 Covariates
$$

When substituting only processed meat with legumes, red meat was added
to the model:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Red meat (15g) + \beta_3 Total food intake (g) + \beta_4 Other food groups(g) + \beta_5 Covariates
$$

**Statistical analysis**

Multivariable-adjusted Cox proportional hazards regression models were
used to estimate hazard ratios (HR) with corresponding 95% confidence
intervals (CI) with age as the underlying timescale. Participants were
followed from the date of their last completed diet questionnaire until
the event of interest occurred or due to right censoring, whichever came
first. Participants were right censored due to one of the following
events occurring: death, loss to follow-up, or administrative end of
follow-up (set to Jan 31, 2022). Two levels of adjustments were added to
the substitution model. A crude model was minimally adjusted for age,
total weight of food intake, and all other foods groups to fit the
substitution model. The adjusted model was further adjusted for sex,
educational level, Townsend Deprivation Index, living alone, physical
activity, smoking, alcohol intake, and waist circumference.

A stratified analysis on each cancer type was performed to test whether
pooling of HCC and ICC as an outcome was justified. Further, the
following sensitivity analyses were performed to test the robustness of
the main analysis:

1.       Exclusion of high alcohol consumers (more than 32 grams per day
for men and 24 grams per day for women), exclusion of food intake
misreporters (≤ 3200 or ≥ 16800 kJ/day for men and ≤ 2000 or ≥ 14000
kJ/day for women), exclusion of participants with any other liver
disease before baseline, exclusion of participants with any type of
cancer before baseline, and exclusion of the first two years of
follow-up.

2.       Inclusion criteria for number of completed diet questionnaires
were set to ≥3 completed questionnaires.

3.       (Mangler)

To estimate the effect of legume intake regardless of other dietary
components, legume consumers (divided into quartiles) were compared to
non-consumers.

All analyses were conducted in R with a significance level of 5 %.

# Results

After excluding participants with liver cancer and participants lost to
follow-up before baseline, 126,744 participants remained who had
completed two or more diet questionnaires. During a median follow-up
time of 11.3 years, 173 participants developed liver cancer. Baseline
characteristics are displayed in table 1. Participants who developed
liver cancer were older at baseline, had a higher waist circumference,
were less physically active, fewer had never smoked, and more were male,
compared to all included participants.

Mean daily energy intake and food intake and median daily intake of all
specified food groups are presented in table 2.

Main results are presented in table 3. In the crude model, no
association was found for substituting 15 grams of legumes per day with
15 grams of total meat, red meat, or processed meat per day and risk of
primary liver cancer (total meat: HR: 0.98 (95% CI: 0.93, 1.04), red
meat: HR: 0.97 (95% CI: 0.91-1.03) and processed meat: HR 1.02 (95%
CI:0.93, 1.13)). the results did not change when with further
adjustments (total meat: HR: 1.02 (95% CI: 0.96, 1.08), red meat: HR:
1.00 (95% CI: 0.94-1.07) and processed meat: HR: 1.09 (95% CI: 0.98,
1.20).

Estimates seemed to go in opposite directions when substituting total
meat or red meat with legumes for risk of HCC (total meat: HR: 1.08 (95%
CI: 0.99, 1.19), red meat: HR: 1,07 (95% CI: 0.97, 1.18) and processed
meat: HR: 1.12 (95% CI: 0.97, 1.30)) and ICC (total meat: HR: 0.97 (95%
CI: 0.90, 1.05), red meat: HR: 0.95 (95% CI: 0.87, 1.03) and processed
meat: HR: 1.06 (95% CI: 0.92, 1.22)) , but these trends were not
statistically significant (supplementary table 2). Further, excluding
high alcohol consumers or food intake misreporters or setting inclusion
criteria to ≥ 3 completed diet questionnaires did not alter the
estimates in any statistically significant way (supplementary tables 3
to 5). In the adjusted no substitution analysis, a mean intake of 6.3
grams of legumes per day was associated with a reduced risk of liver
cancer, compared to no intake (HR: 0.59 (95% CI: 0.35, 0.98)); however,
no associations were observed with further increase in legume intake
(supplementary table 6).

# Conclusions

# Acknowledgements

# References

::: {#refs}
:::

# Tables

```{r baseline table}
table_1_all <- data %>%
  select(typical_diet, age_at_baseline, sex, education, tdi, spouse, exercise, smoking, alcohol_daily, wc)

table_1_cancer <- data %>%
  filter(status == "Liver cancer") %>%
  select(typical_diet, age_at_baseline, sex, education, tdi, spouse, exercise, smoking, alcohol_daily, wc)

table_all <- table_1_all %>%
  tbl_summary(
    missing_text = "Missing",
    label = list(
      typical_diet ~ "Typical diet yesterday",
      age_at_baseline ~ "Age",
      sex ~ "Sex",
      education ~ "Educational level",
      tdi ~ "Townsend Deprivation Index",
      spouse ~ "Living alone",
      exercise ~ "Physical activity",
      smoking ~ "Smoking",
      alcohol_daily ~ "Alcohol intake [g/day]",
      wc ~ "Waist circumference [cm]"
    ),
    digits = tdi ~ 1
  )

table_cancer <- table_1_cancer %>%
  tbl_summary(
    missing_text = "Missing",
    label = list(
      typical_diet ~ "Typical diet yesterday",
      age_at_baseline ~ "Age",
      sex ~ "Sex",
      education ~ "Educational level",
      tdi ~ "Townsend Deprivation Index",
      spouse ~ "Living alone",
      exercise ~ "Physical activity",
      smoking ~ "Smoking",
      alcohol_daily ~ "Alcohol intake [g/day]",
      wc ~ "Waist circumference [cm]"
    ),
    digits = tdi ~ 1
  )

table_combined <- tbl_merge(
  tbls = list(table_all, table_cancer),
  tab_spanner = c("**Cohort**", "**Liver cancer**")
) %>%
  bold_labels() %>%
  modify_caption("**Table 1. Baseline characteristics of UK Biobank participants who completed ≥ 2 Oxford WebQ 24-hour diet recall.**") %>%
  modify_header(label ~ "**Variable**") %>%
    modify_table_styling(
    columns = label,
    rows = label == "Typical diet yesterday",
    footnote = "Participants who reported eating a typical diet yesterday for all completed diet questionnaires."
  ) %>% 
    modify_table_styling(
    columns = label,
    rows = label == "Physical activity",
    footnote = "Above or below the 2017 UK Physical activity guidelines of 150 minutes of moderate activity per week or 75 minutes of vigorous activity."
  )
table_combined %>% as_gt()
```

```{r diet table}
diet_all_mean <- data %>%
  select(
    total_energy_food_daily, total_weight_food_daily
  )

diet_all_median <- data %>%
  select(
    legume_daily, total_meat_daily,
    red_meat_daily, proc_meat_daily, animal_foods, hpdi, updi, alc_beverage_daily
  )

diet_liver_mean <- data %>%
  filter(status == "Liver cancer") %>%
  select(
    total_energy_food_daily, total_weight_food_daily
  )

diet_liver_median <- data %>%
  filter(status == "Liver cancer") %>%
  select(
    legume_daily, total_meat_daily,
    red_meat_daily, proc_meat_daily, animal_foods, hpdi, updi, alc_beverage_daily
  )

diet_all_table_mean <- diet_all_mean %>%
  tbl_summary(
    statistic = all_continuous() ~ "{mean} ({sd})",
    label = list(
      total_energy_food_daily ~ "Energy [kJ]",
      total_weight_food_daily ~ "Weight [g]"
    )
  )

diet_all_table_median <- diet_all_median %>%
  tbl_summary(
    statistic = all_continuous() ~ "{median} ({p25}, {p75})",
    label = list(
      legume_daily ~ "Legumes",
      total_meat_daily ~ "Red and processed meat",
      red_meat_daily ~ "Red meat",
      proc_meat_daily ~ "Processed meat",
      animal_foods ~ "Other animal-based foods",
      hpdi ~ "Healthy plant-based foods",
      updi ~ "Unhealthy plant-based foods",
      alc_beverage_daily ~ "Alcoholic beverages"
    )
  )

diet_liver_table_mean <- diet_liver_mean %>%
  tbl_summary(
    statistic = all_continuous() ~ "{mean} ({sd})",
    label = list(
      total_energy_food_daily ~ "Energy [kJ]",
      total_weight_food_daily ~ "Weight [g]"
    )
  )

diet_liver_table_median <- diet_liver_median %>%
  tbl_summary(
    statistic = all_continuous() ~ "{median} ({p25}, {p75})",
    label = list(
      legume_daily ~ "Legumes",
      total_meat_daily ~ "Red and processed meat",
      red_meat_daily ~ "Red meat",
      proc_meat_daily ~ "Processed meat",
      animal_foods ~ "Other animal-based foods",
      hpdi ~ "Healthy plant-based foods",
      updi ~ "Unhealthy plant-based foods",
      alc_beverage_daily ~ "Alcoholic beverages"
    )
  )

row1 <- tbl_merge(list(diet_all_table_mean, diet_liver_table_mean), tab_spanner = c("**Cohort**", "**Liver cancer**")) %>%
  bold_labels() %>%
  modify_caption("**Table 2. Daily dietary intake.**") %>%
  modify_footnote(all_stat_cols() ~ "mean (±SD) for total food intake; median (IQR) for food groups")
row2 <- tbl_merge(list(diet_all_table_median, diet_liver_table_median)) %>%
  bold_labels()

diet_table <-
  tbl_stack(list(row1, row2),
            quiet = TRUE,
            group_header = c("Total food intake [kJ/day] or [g/day]", "Food groups [g/day]")) %>%
  modify_header(label ~ "**Daily food intake**") %>% 
  as_gt() 
diet_table
```

```{r main results table}
model1t <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data
)

model2t <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data
)

model1r <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data
)

model2r <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data
)

model1p <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data
)

model2p <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data
)


m1t <- model1t %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r <- model1r %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p <- model1p %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t <- model2t %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r <- model2r %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p <- model2p %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t, m2t)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r, m2r))
row3 <- tbl_merge(list(m1p, m2p))

table_main <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Table 3. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
  ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_main
```

# Figures

# Supplemental Material

![Figure 1. Directed acyclic graph visualizing the relationship between
the exposure, replacing meat with legumes, and the outcome, liver
cancer. Red circles indicate ancestors of exposure and outcome with red
arrows being biasing paths. The NAFLD circle is blue to indicate that it
is an ancestor of the outcome. The green arrows are causal
paths.](Images/DAG.png)

```{r food table new}
id <- data.frame(id = 1:25)

food_group <- c(
  "Legumes", "Red meat", "Processed meat",
  "Animal-based foods", "Poultry", "Fish", "Dairy", "Eggs", "Sauces", "Mixed dishes", "Healthy plant-based foods",
  "Whole grains", "Fruits", "Nuts", "Plant oils", "Beverages", "Vegetables",
  "Unhealthy plant-based foods", "Refined cereals",
  "Potatoes", "Fruit juice", "Mixed dishes, vegetarian", "Sweets & snacks",
  "Sugar sweetened beverages", "Alcoholic beverages"
)
food_group_df <- data.frame(food_group)

includes <- c(
  "Soya-based desserts, Baked beans, pulses, Soya drinks (including calcium fortified),
  Tofu-based products, Hummus, Peas",
  
  "Beef, Lamb, Other meat including offal, Pork",
  
  "Sausages, bacon (with and without fat), ham, liver pate",
  
  " ",
  
  "Fried poultry with batter/breadcrumbs, Poultry (with/without skin)",
  
  "Fried fish with batter/breadcrumbs, Oily fish, including salmon, Prawns, lobster, crab, shellfish,
  Tinned tuna, white fish, other fish",
  
  "Spreadable/lower fat butter, dairy-based very low fat spread, Spreadable normal fat butter, dairy-based normal fat spread (including cholesterol lowering spread),
  Ice cream, milk puddings, milk-based desserts, cheesecake, Dairy-based smoothies, milk-based drinks, hot chocolate,
  Whole milk yogurt (plain), Cheese >17.5 g fat per 100 g, including hard cheese, soft cheese, spreadable, Blue, Feta, Mozzarella, Goats, other),
  Fat free and lower fat yogurt, plain or flavoured, Cheese <=17.5g fat per 100 g, including hard and spreadable lower fat cheese, Cottage,
  Semi-skimmed milk >1 g fat per 100 g (cow, other), Skimmed milk <1 g fat per 100 g (cow, cholesterol lowering, powdered),
  Whole milk >3.6 g fat per 100 g (cow, goat, sheep), Cream (cow's milk)",
  
  "Whole eggs and processed (omelette, scotch eggs, other)",
  
  "Mayonnaise, salad dressing, pesto, cheese sauce, white sauce, gravy, Yeast, chutney, olives, ketchup, brown sauce, tomato sauce",

  "Pizza (including gluten free crust), Crisps, savoury biscuits, cheese snacks, other savoury biscuits,
  Soups, homemade, powdered and canned, Sushi",
  
  " ",
  
  "Mixed, brown or seeded bread, sliced, baguette, bap, roll, Wholemeal bread, sliced, baguette, bap, roll,
  Wholewheat biscuit cereal, Bran cereal, Porridge oats (including milk/dried fruit added),
  Oatcrunch breakfast cereal, Muesli (with or without dried fruit), Brown and wholemeal pasta and rice",
  
  "Apples and pears, Blackberries, strawberries, blueberries, raspberries, cherries, Grapefruit, orange, satsuma,
  Dried fruit, prunes, Bananas, mixed fruit, grapes, mango, melon, peach, pineapple, kiwi, other, Stewed fruit, plums",
  
  "Peanut-butter and chocolate-based spread, Unsalted peanuts and nuts, Salted peanuts and nuts",
  
  "Olive oil, Olive oil based lower fat spread, plant-based lower fat margarine and soya-based lower fat spread (including cholesterol lowering spread),
  Olive oil based spread, plant-based soft or hard margarine and soya-based spread (including cholesterol lowering spread)",
  
  "Normal instant, filter, cappuccino, espresso coffee, Decaffeinated instant, filter, cappuccino, espresso coffee,
  Black, green and other tea, Decaffeinated black, herbal tea, rooibos, Plain water, sparkling water",
  
  "Garlic, leek, onion, Broccoli, cabbage, kale, cauliflower, spinach, sprouts, Mixed side salad, lettuce, watercress,
  Beetroot, carrots, celery, parsnip, turnip, Fresh and tinned tomatoes,
  Mushrooms, mixed vegetables, avocado, broad beans, green beans, butternut squash, courgettes, peppers, other,
  Coleslaw, salad with added fat/mayonnaise, guacamole, sweetcorn",
  
  " ",
  
  "Chocolate biscuits, plain biscuits, sweet biscuits and cookies, Naan, garlic bread, other bread (including gluten free),
  White bread, sliced, baguette, bap, roll, Oatcrunch breakfast cereal, Crisps, savoury biscuits, cheese snacks, other savoury biscuits,
  White pasta, rice, couscous, gluten free pasta",
  
  "Potatoes, sweet potatoes, boiled or baked, Potatoes and chips, fried or roasted with fat, Potatoes, mashed",
  
  "Orange, grapefruit drink and 100% fruit juice",
  
  "Double and single crust pies, crumble pies, Yorkshire pudding, snackpot noodles,
  Indian samosa, pakora snacks, Quorn-based and vegetarian burgers and products",
  
  "Table sugar, honey, jam and preserves,
  Chocolate bar (including white, milk and dark chocolate), chocolate-covered raisins, chocolate-covered sweets,
  Pancakes, croissant, Danish pastries, scones, fruitcakes, cakes, doughnuts, sponge puddings, other desserts, cereal bars, sweet snacks,
  Hard and soft sweets (including sugar free)",
  
  "Rice and oat vegetable drinks, Low calorie fizzy drinks and squash, Fizzy sugary drinks, squash, fruit smoothies",
  
  "Beer and cider, Spirits and other alcoholic drinks, Fortified wine, Red and rose wine, White wine"
)

includes_df <- data.frame(includes)

df <- data.frame(food_group = food_group_df,
                 includes = includes)

bold_text <- c(1, 2, 3, 4, 11, 18, 25)
indent_text <- c(5, 6)
food_group_table <- df %>%
  gt() %>% 
  tab_caption(caption = md("**Supplementary table 1. Summary of included foods for each food group.**")) %>% 
  cols_label(
    food_group = md("**Food group**"),
    includes = md("**Includes**")
  ) |> 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = food_group,
      rows = bold_text
    )
  )

food_group_table
```

```{r sup table 1}
id <- data.frame(id = 1:120)

food_group <- c(
  "Legumes", "Soya-based desserts & yogurt", "Legumes/pulses", "Soy drink",
  "Soy-based meals", "Vegetable dips", "Peas/sweetcorn", "Red meat", "Beef",
  "Lamb", "Other meat, offal", "Pork", "Processed meat", "Processed meat",
  "Animal-based foods", "Poultry", "Breaded/battered Chicken", "Poultry",
  "Fish", "Bre aded/battered Fish", "Oily fish", "Shellfish",
  "White fish & tinned tuna", "Dairy", "Dairy fat spread lower fat",
  "Dairy fat spread", "Milk-dairy desserts", "Milk-based & powdered drinks",
  "Full fat yogurt", "High fat cheese", "Low fat yogurt",
  "Medium & low fat cheese", "Semi-skimmed milk", "Skimmed milk",
  "Whole milk", "Cream", "Eggs", "Egg and egg dishes", "Sauces",
  "Sauces (higher fat)", "Sauces (lower fat)", "Mixed dishes", "Pizza",
  "Savoury snacks", "Soups", "Sushi", "Healthy plant-based foods",
  "Whole grains", "Mixed bread, brown & seeded", "Wholemeal bread",
  "Biscuit cereal", "Bran cereal", "Oat cereal (non-sugar)",
  "Oat cereal (sugar)", "Muesli", "Wholemeal pasta, brown rice & other wholegrains",
  "Fruits", "Apples & pears", "Berries", "Citrus", "Dried fruit",
  "Bananas & other fruit", "Stewed fruit", "Nuts", "Nut-based spreads",
  "Unsalted nuts & seeds", "Salted nuts & seeds", "Plant oils",
  "Olive oil ( drizz ling/dunking)", "Vegetable spread lower fat",
  "Vegetable spread", "Beverages", "Coffee, caffeinated",
  "Coffee, decaffeinated", "Tea", "Tea, decaffeinated", "Water/sparkling water",
  "Vegetables", "Allium vegetables", "Green l eafy/cabbages", "Raw salad",
  "Root vegetables", "Tomatoes", "Other vegetables (mushrooms, fruiting, mixed)",
  "Vegetable side dishes", "Vegetable dips", "Peas/sweetcorn",
  "Unhealthy plant-based foods", "Refined cereals", "Biscuits", "Other bread",
  "White bread", "Oat cereal (sugar)", "Savoury snacks", "White pasta & rice",
  "Potatoes", "Potatoes/sweet potatoes ( baked/boiled)",
  "Fried/roast potatoes", "Mashed potatoes", "Fruit juice", "Fruit juice",
  "Mixed dishes, vegetarian", "Grain dishes - added fat", "Samosa, pakora",
  "Vegetarian meals", "Sweets & snacks", "Added sugars & preserves",
  "Chocolate confectionery", "Desserts & cakes & pastries", "Other sweets",
  "Sugar sweetened beverages", "Rice/oat drink", "Low/non sugar SSBs",
  "SSBs & other sugary drinks", "Alcoholic beverages", "Beer & Cider", "Spirits",
  "Fortified wine", "Red wine", "White wine"
)
food_group_df <- data.frame(food_group)

includes <- c(
  " ", "Soya-based desserts", "Baked beans, pulses", "Soya drinks (including calcium fortified)",
  "Tofu-based products", "Hummus, guacamole (assuming 50% hummus)", "Peas, sweetcorn (assuming 50% peas)",
  " ", "Beef", "Lamb", "Other meat including offal", "Pork", " ",
  "Sausages, bacon (with and without fat), ham, liver pate", " ", " ",
  "Fried poultry with batter/breadcrumbs", "Poultry (with/without skin)", " ",
  "Fried fish with batter/breadcrumbs", "Oily fish, including salmon", "Prawns, lobster, crab, shellfish",
  "Tinned tuna, white fish, other fish", " ", "Spreadable/lower fat butter, dairy-based very low fat spread",
  "Spreadable normal fat butter, dairy-based normal fat spread (including cholesterol lowering spread)",
  "Ice cream, milk puddings, milk-based desserts, cheesecake", "Dairy-based smoothies, milk-based drinks, hot chocolate",
  "Whole milk yogurt (plain)", "Cheese >17.5 g fat per 100 g, including hard cheese, soft cheese, spreadable, Blue, Feta, Mozzarella, Goats, other)",
  "Fat free and lower fat yogurt, plain or flavoured", "Cheese <=17.5g fat per 100 g, including hard and spreadable lower fat cheese, Cottage",
  "Semi-skimmed milk >1 g fat per 100 g (cow, other)", "Skimmed milk <1 g fat per 100 g (cow, cholesterol lowering, powdered)",
  "Whole milk >3.6 g fat per 100 g (cow, goat, sheep)", "Cream (cow's milk)", " ",
  "Whole eggs and processed (omelette, scotch eggs, other)", " ", "Mayonnaise, salad dressing, pesto, cheese sauce, white sauce, gravy",
  "Yeast, chutney, olives, ketchup, brown sauce, tomato sauce", " ",
  "Pizza (including gluten free crust)", "Crisps, savoury biscuits, cheese snacks, other savoury biscuits",
  "Soups, homemade, powdered and canned", "Sushi", " ", " ",
  "Mixed, brown or seeded bread, sliced, baguette, bap, roll", "Wholemeal bread, sliced, baguette, bap, roll",
  "Wholewheat biscuit cereal", "Bran cereal", "Porridge oats (including milk/dried fruit added)",
  "Oatcrunch breakfast cereal", "Muesli (with or without dried fruit)", "Brown and wholemeal pasta and rice", " ",
  "Apples and pears", "Blackberries, strawberries, blueberries, raspberries, cherries", "Grapefruit, orange, satsuma",
  "Dried fruit, prunes", "Bananas, mixed fruit, grapes, mango, melon, peach, pineapple, kiwi, other", "Stewed fruit, plums", " ",
  "Peanut-butter and chocolate-based spread", "Unsalted peanuts and nuts", "Salted peanuts and nuts", " ",
  "Olive oil", "Olive oil based lower fat spread, plant-based lower fat margarine and soya-based lower fat spread (including cholesterol lowering spread)",
  "Olive oil based spread, plant-based soft or hard margarine and soya-based spread (including cholesterol lowering spread)", " ",
  "Normal instant, filter, cappuccino, espresso coffee", "Decaffeinated instant, filter, cappuccino, espresso coffee",
  "Black, green and other tea", "Decaffeinated black, herbal tea, rooibos", "Plain water, sparkling water", " ",
  "Garlic, leek, onion", "Broccoli, cabbage, kale, cauliflower, spinach, sprouts", "Mixed side salad, lettuce, watercress",
  "Beetroot, carrots, celery, parsnip, turnip", "Fresh and tinned tomatoes",
  "Mushrooms, mixed vegetables, avocado, broad beans, green beans, butternut squash, courgettes, peppers, other",
  "Coleslaw, salad with added fat/mayonnaise", "Hummus, guacamole (assuming 50% guacamole)", "Peas, sweetcorn (assuming 50% sweetcorn)", " ", " ",
  "Chocolate biscuits, plain biscuits, sweet biscuits and cookies", "Naan, garlic bread, other bread (including gluten free)",
  "White bread, sliced, baguette, bap, roll", "Oatcrunch breakfast cereal", "Crisps, savoury biscuits, cheese snacks, other savoury biscuits",
  "White pasta, rice, couscous, gluten free pasta", " ",
  "Potatoes, sweet potatoes, boiled or baked", "Potatoes and chips, fried or roasted with fat", "Potatoes, mashed", " ",
  "Orange, grapefruit drink and 100% fruit juice", " ",
  "Double and single crust pies, crumble pies, Yorkshire pudding, snackpot noodles",
  "Indian samosa, pakora snacks", "Quorn-based and vegetarian burgers and products", " ",
  "Table sugar, honey, jam and preserves",
  "Chocolate bar (including white, milk and dark chocolate), chocolate-covered raisins, chocolate-covered sweets",
  "Pancakes, croissant, Danish pastries, scones, fruitcakes, cakes, doughnuts, sponge puddings, other desserts, cereal bars, sweet snacks",
  "Hard and soft sweets (including sugar free)", " ",
  "Rice and oat vegetable drinks", "Low calorie fizzy drinks and squash", "Fizzy sugary drinks, squash, fruit smoothies", " ",
  "Beer and cider", "Spirits and other alcoholic drinks", "Fortified wine", "Red and rose wine", "White wine"
)

includes_df <- data.frame(includes)

uk_bio_bank_id <- c(
  " ", "p26086", "p26101", "p26136", "p26137", "p26144", "p26115", " ", "p26066",
  "p26100", "p26104", "p26117", " ", "p26122", " ", " ", "p26069", "p26121", " ",
  "p26070", "p26109", "p26132", "p26149", " ", "p26062", "p26063", "p26084", "p26087",
  "p26096", "p26099", "p26102", "p26103", "p26131", "p26133", "p26150", "p26154",
  " ", "p26088", " ", "p26129", "p26130", " ", "p26116", "p26134", "p26135", "p26139",
  " ", " ", "p26071", "p26074", "p26075", "p26076", "p26077", "p26078", "p26105",
  "p26114", " ", "p26089", "p26090", "p26091", "p26092", "p26093", "p26094", " ",
  "p26106", "p26107", "p26108", " ", "p26110", "p26111", "p26112", " ", "p26081",
  "p26082", "p26141", "p26142", "p26148", " ", "p26065", "p26098", "p26123", "p26125",
  "p26143", "p26146", "p26147", "p26144", "p26115", " ", " ", "p26068", "p26072",
  "p26073", "p26079", "p26083", "p26113", " ", "p26118", "p26119", "p26120", " ",
  "p26095", " ", "p26097", "p26128", "p26145", " ", "p26064", "p26080", "p26085", "p26140",
  " ", "p26124", "p26126", "p26127", " ", "p26067", "p26138", "p26151", "p26152", "p26153"
)
ukb_id_number_df <- data.frame(uk_bio_bank_id)

df <- data.frame(food_group = food_group_df,
                 includes = includes)

bold_text <- c(1, 8, 13, 15, 47, 88)
italic_text <- c(16, 19, 24, 37, 39, 42, 48, 57, 64, 68, 72, 78, 89, 96, 100, 102, 106, 111, 115)
food_group_table <- df %>%
  gt() %>% 
  tab_caption(caption = md("**Supplementary table 1. Summary of included foods for each food group.**")) %>% 
  cols_label(
    food_group = md("**Food group**"),
    includes = md("**Includes**")
  ) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = food_group,
      rows = bold_text
      )
    ) %>% 
  tab_style(
    style = cell_text(style = "italic"),
    locations = cells_body(
      columns = food_group,
      rows = italic_text
    )
  )
  
food_group_table
```

```{r stratified on cancer type}
model1t_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2t_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

model1r_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2r_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

model1p_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2p_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

m1t_hcc  <- model1t_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_hcc  <- model1r_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_hcc  <- model1p_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_hcc  <- model2t_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_hcc  <- model2r_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_hcc  <- model2p_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

model1t_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2t_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

model1r_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2r_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

model1p_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2p_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

m1t_icc  <- model1t_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_icc  <- model1r_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_icc  <- model1p_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_icc  <- model2t_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_icc  <- model2r_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_icc  <- model2p_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_hcc, m2t_hcc)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_hcc, m2r_hcc))
row3 <- tbl_merge(list(m1p_hcc, m2p_hcc))
row4 <- tbl_merge(list(m1t_icc, m2t_icc))
row5 <- tbl_merge(list(m1r_icc, m2r_icc))
row6 <- tbl_merge(list(m1p_icc, m2p_icc))

table_cancer_type <-
  tbl_stack(list(row1, row2, row3, row4, row5, row6),
            group_header = c("Hepatocellular carcinoma", "Hepatocellular carcinoma", "Hepatocellular carcinoma", "Intrahepatic cholangiocarcinoma", "Intrahepatic cholangiocarcinoma", "Intrahepatic cholangiocarcinoma")) %>%
  modify_caption("**Supplementary table 2. Hazard ratios for substitution of legumes for total meat, red meat and processed meat for hepatocellular carcinoma (Hcc) and intrahepatic cholangiocarcinoma (ICC).** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
    ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
    ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_cancer_type
```

```{r exclusion of high alcohol consumers}
model1t_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2t_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)

model1r_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2r_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)

model1p_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2p_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)


m1t_alc <- model1t_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_alc <- model1r_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_alc <- model1p_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_alc <- model2t_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_alc <- model2r_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_alc <- model2p_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_alc, m2t_alc)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_alc, m2r_alc))
row3 <- tbl_merge(list(m1p_alc, m2p_alc))

table_alc <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 3. Exclusion of high alcohol consumers. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_alc
```

```{r exclusion of energy misreporters}
model1t_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2t_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

model1r_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2r_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

model1p_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2p_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

m1t_misreporter <- model1t_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_misreporter <- model1r_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_misreporter <- model1p_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_misreporter <- model2t_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_misreporter <- model2r_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_misreporter <- model2p_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_misreporter, m2t_misreporter)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_misreporter, m2r_misreporter))
row3 <- tbl_merge(list(m1p_misreporter, m2p_misreporter))

table_misreporter <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 4. Exclusion of food intake misreporters. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_misreporter
```

```{r 3 or more compled diet questionnaires}
model1t_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2t_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

model1r_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2r_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

model1p_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2p_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

m1t_3_ques_comp <- model1t_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_3_ques_comp <- model1r_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_3_ques_comp <- model1p_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_3_ques_comp <- model2t_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_3_ques_comp <- model2r_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_3_ques_comp <- model2p_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_3_ques_comp, m2t_3_ques_comp)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_3_ques_comp, m2r_3_ques_comp))
row3 <- tbl_merge(list(m1p_3_ques_comp, m2p_3_ques_comp))

table_3_ques_comp <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 5. Participant who completed three or more diet questionnaires. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_3_ques_comp
```

```{r}
model1t <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_category + red_meat_daily + proc_meat_daily +
    animal_foods + hpdi + updi + total_weight_food_daily,
  data = data
)

m1t <- model1t %>%
  tbl_regression(
    exponentiate = T,
    include = legume_category,
    label = legume_category ~ "Legume category",
  ) %>% bold_p(t = 0.05)

model2t <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_category + red_meat_daily + proc_meat_daily +
    animal_foods + hpdi + updi + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data
)

m2t <- model2t %>%
  tbl_regression(
    exponentiate = T,
    include = legume_category,
    label = legume_category ~ "Legume category",
  ) %>% bold_p(t = 0.05)

table_legume <- tbl_merge(
  tbls = list(m1t, m2t)
  ) %>% 
  modify_spanning_header(everything() ~ NA_character_) %>% 
  modify_caption("**Supplementary table 6. No intake of legumes vs. quartiles of daily legume intake** (N = {N})") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
    modify_table_styling(
    columns = label,
    rows = label == "Legume category",
    footnote = "mean daily intake of legumes in grams for each quartile: Q1: 6.3, Q2: 15.7, Q3: 34.3, Q4 109."
  ) %>% 
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>% 
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_legume
```
