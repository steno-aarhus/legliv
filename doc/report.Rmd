---
title: "Substitution of red meat with legumes and risk of primary liver cancer in 126,744 UK Biobank participants: a prospective cohort study"
author:
- name: Niels Bock
  orcid: 0009-0005-7373-1589
  affiliations:
  - name: Department of Public Health, Aarhus University, Aarhus, Denmark
date: "`r Sys.Date()`"
csl: diabetologia.csl
format: html
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
targets::tar_config_set(store = here::here("_targets"))
data <- targets::tar_read(data_cleaned)
data_flowchart <- targets::tar_read(data_flowchart)
data_hcc <- targets::tar_read(data_with_hcc)
data_icc <- targets::tar_read(data_with_icc)
data_alc <- targets::tar_read(data_with_alc)
data_misreporter <- targets::tar_read(data_with_misreporter)
data_3_ques_comp <- targets::tar_read(data_with_3_ques_comp)
library(here)
library(gt)
library(gtsummary)
library(tidyverse)
library(survival)
library(ggconsort)
source(here("R","2-table1.R"))
source(here("R","4-diet-table.R"))
source(here("R","3-1-main-analysis-table"))
```

```{r, include=FALSE}
model1t_leg <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_category + red_meat_daily + proc_meat_daily +
    animal_foods + hpdi + updi + total_weight_food_daily,
  data = data
)

m1t_leg <- model1t_leg %>%
  tbl_regression(
    exponentiate = T,
    include = legume_category,
    label = legume_category ~ "Legume category",
  ) %>% bold_p(t = 0.05)

model2t_leg <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_category + red_meat_daily + proc_meat_daily +
    animal_foods + hpdi + updi + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data
)

m2t_leg <- model2t_leg %>%
  tbl_regression(
    exponentiate = T,
    include = legume_category,
    label = legume_category ~ "Legume category",
  ) %>% bold_p(t = 0.05)
```

# Abstract

Objective:

Research Design and Methods:

Results:

Conclusions:

# Introduction

# Research Design and Methods

**Study population**

The UK Biobank, a population-based prospective cohort, wasinitiated in
2006. [@sudlow2015] During 2006-2010, more than 500,000 participants,
aged 40-69, were recruited and visited designated assessment centres
across the UK Participants provided information about age, sex,
sociodemographic factors (education, Townsend deprivation index, living
alone) and lifestyle factors (smoking, alcohol consumption, physical
activity) via touch screen questionnaires and computer-assisted
interviews. Anthropometric data (BMI, waist circumference) were
collected via physical measurements (reference to UKB document here).

**Dietary assessment**

A web-based 24-hour dietary recall was administered at the end of the
initial assessment visit for the last 70,000 recruited participants
(reference from UKB document here). From February 2011 to April 2012,
320,000 participants who had provided an e-mail address were invited on
four separate occasions to complete the 24-hour dietary recall, the
Oxford WebQ, of which 210,947 participants completed at least one. The
Oxford WebQ covered 206 food items and 32 beverage items commonly
consumed in the UK. Intakes were reported in standard units of
measurements, e.g., servings, cups, slices, etc. with intake categories
ranging from 0 to 3+ units [@piernas2021]. The Oxford WebQ has been
validated againts interviewer-based 24-hour dietary recalls and
biomarkers [@Liu2011; @Greenwood2019].

Researchers defined79 food groups and 14 beverage groups from the Oxford
WebQ using the UK National Diet and Nutrition Survey categories
[@piernas2021]. These food and beverage groups were used when defining
the food groups used in the substitution analyses (Supplementary Table
1). Legumes were defined as dietary pulses, baked beans, tofu-based
products, peas, hummus, soy drinks, and soy-based desserts and yogurt.
Red meat intake was defined as intake of beef, pork, lamb, or other
meat, including offal. Processed meat intake was defined as sausages,
bacon (with and without fat), ham, or liver pate. Other food groups
included were animal-based foods, unhealthy plant-based foods, healthy
plant-based foods, and alcoholic beverages (Supplementary Table 1).
Animal-based and healthy and unhealthy plant-based food foods were
grouped based on plant-based diet indices from previous studies
[@Thompson2023; @Heianza2021; @Satija2017; @Satija2016]. An overview of
included foods in each food group is displayed in Supplementary Table 1.

Due to the incapability of a single 24-hour dietary recall to properly
assess habitual dietary intake and variation in diet over time
[@thompson2013; @gurinovic2017], only participants who completed two or
more Oxford WebQs were eligible for inclusion in this study.

**Liver cancer assessment**

Liver cancer was defined according to ICD-10 diagnosis codes C22.0 for
Hepatocellular carcinoma (HCC) or C22.1 for Intrahepatic
cholangiocarcinoma (ICC). Incident and prevalent cases of liver cancer
and corresponding diagnosis dates were obtained via linkage to central
cancer registries or hospital inpatient episodes [@sudlow2015].

**Assessment of confounders**

Confounders were defined *a priori* from a literature review of the
background literature and illustrated using directed acyclic graphs
(Supplementary Figure 1). The following confounding variables were
selected: age at baseline (years, continuous), sex (male, female),
educational level (high: College or University degree, intermediate: A
levels/AS levels, O levels/GCSEs, or equivalent, low: none of the
previous mentioned), Townsend Deprivation Index (continuous), Living
alone (yes, no), waist circumference (cm, continuous), physical activity
(above/below the 2017 UK Physical activity guidelines of 150 minutes of
moderate activity per week or 75 minutes of vigorous activity, or
unknown), smoking (pack years as a proportion of lifespan exposed to
smoking, continous), and alcohol intake (g/day, continuous). All
confounders except age were selected from the initial assessment visit
before the start of follow-up.

**The substitution model**

The substitution analyses were conducted by replacing an equal mass of
meat with legumes. The size of the substitution was set to 15 g of
legumes for 15 g of meat to keep the substitution size below the mean
intake of any of the substituted food groups in the cohort. The
substitutions were modelled using the leave-one-out-approach in which
variables for every food group along with a variable for total food
intake are included, except the food group that are to be substituted
[@Ibsen2021]. To estimate substitution of 15 g of all red meats (red and
processed) with 15 g of legumes, the following model was defined:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Total food intake (g) + \beta_3 Other food groups(g) + \beta_4 Covariates
$$

When substituting only red meat with legumes, processed meat was added
to the model:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Processed meat (15g) + \beta_3 Total food intake (g) + \beta_4 Other food groups(g) + \beta_5 Covariates
$$

When substituting only processed meat with legumes, red meat was added
to the model:

$$
log(h(t;x)) = log(h(0;t)) + \beta_1 Legumes (15g) + \beta_2 Red meat (15g) + \beta_3 Total food intake (g) + \beta_4 Other food groups(g) + \beta_5 Covariates
$$

**Statistical analysis**

Multivariable-adjusted Cox proportional hazards regression models were
used to estimate hazard ratios (HR) with corresponding 95% confidence
intervals (CI) with age as the underlying timescale. Participants were
followed from the date of their last completed Oxford WebQ until the
occurrence of the event of interest or due to right censoring, whichever
came first. Participants were right censored in the event of death, loss
to follow-up, or administrative end of follow-up (January 31, 2022). Two
levels of adjustments were added to the substitution model. Model 1 was
minimally adjusted for age, total weight of food intake, and all other
food groups to fit the substitution model. Model was further adjusted
for sex, educational level, Townsend Deprivation Index, living alone,
physical activity, smoking, alcohol intake, and waist circumference.

In secondary analyses, each cancer type was analysed separately to
evaluate if the pooling of HCC and ICC as one outcome in the main
analysis was justified. Furthermore, to estimate the effect of legume
intake regardsless of other dietary components, legume consumers
(divided into quartiles) were compared to non-consumers in secondary
analyses.

To evaluate the robustness of the main analyses, sensitivity analyses
were performed on subsamples of participants by excluding those with
high alcohol intake (more than 32 grams per day for men and 24 grams per
day for women), participants with plausible energy intake misreporting
(≤ 3200 or ≥ 16800 kJ/day for men and ≤ 2000 or ≥ 14000 kJ/day for
women), participants with any other liver disease before baseline, and
participants with any type of cancer before baseline.

Furthermore, sensitivity analyses were conducted by including only those
with ≥3 completed Oxford WebQs.

3.       (Mangler)

Sensitivity analyses were modelled like the main analyses.

All analyses were conducted in R (version) with a significance level of
5 %.

# Results

After excluding participants with liver cancer and participants lost to
follow-up before baseline, 126,744 participants remained who had
completed two or more diet questionnaires. During a median follow-up
time of 11.3 years, 173 participants developed liver cancer.
Participants who developed liver cancer were older at baseline, had a
higher waist circumference, were less physically active, fewer had never
smoked, and more were male, compared to all included participants (Table
1).

Mean daily energy intake and food intake and median daily intake of all
specified food groups are presented in table 2.

No association was found for substituting 15 g/day of legumes with 15
g/day of total meat, red meat, or processed meat and risk of primary
liver cancer in model 1 (Table 3: total meat:
`r inline_text(m1t, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`;
red meat:
`r inline_text(m1r, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`;
processed meat:
`r inline_text(m1p, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`).
The estimated associations changed minimally but remained
non-significant with further adjustments (Table 3: total meat:
`r inline_text(m2t, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`;
red meat:
`r inline_text(m2r, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`;
processed meat:
`r inline_text(m2p, variable = legume_daily_15, pattern = '{estimate} (95% {ci})')`).

In secondary analyses, when analyzing the substitution association for
HCC and ICC separately, the risk of HCC was positively associated with
substituting total, red, or processed meat with legumes (Supplementary
Table 2, total meat: HR: 1.08, 95% CI: 0.99, 1.19; red meat: HR: 1.07,
95% CI: 0.97, 1.18; processed meat: HR: 1.12, 95% CI: 0.97, 1.30). The
association between substituting total, red, or processed meat with
legumes and ICC indicated inverse associations (Supplementary Table 2,
total meat: HR: 0.97, 95% CI: 0.90, 1.05; red meat: HR: 0.95, 95% CI:
0.87, 1.03; processed meat: HR: 1.06, 95% CI: 0.92, 1.22). The magnitude
or direction of associations were not significantly different across
strata of liver cancer types.

In the adjusted non-substitution analysis, a mean intake of 6.3 grams of
legumes per day was associated with a reduced risk of liver cancer,
compared to no intake
(`r inline_text(m2t_leg, variable = legume_category, level = "Q1", pattern = '{estimate} (95% {ci})')`);
however, no associations were observed with further increase in legume
intake (supplementary table 6).

In sensitivity analyses, excluding participants with high alcohol intake
or participants with plausible energy intake misreporting or setting
inclusion criteria to ≥ 3 completed diet questionnaires did not alter
the estimates in any statistically significant way (supplementary tables
3 to 5).

# Conclusions

# Acknowledgements

# References

::: {#refs}
:::

# Tables

```{r baseline table}
table_one
```

\newpage

```{r diet table}
diet_table
```

```{r main results table, echo=FALSE}
set_gtsummary_theme(theme_gtsummary_journal("jama"),
                    quiet = TRUE)
table_main
```

# Figures

```{r, fig.cap = "Figure 1. Flowchart of included participants"}
ready_flowchart <-
  data_flowchart %>%
  cohort_start("Whole UK Biobank") %>%
  cohort_define(
    one_ques = .full %>% filter(p20077 >= 1),
    two_ques = one_ques %>% filter(p20077 >= 2),
    liver = two_ques %>% filter(is.na(cancer_before)),
    l2fu = two_ques %>% filter(is.na(p191) | p191 >= baseline_start_date),
    both = two_ques %>% filter(is.na(cancer_before)) %>% filter(is.na(p191) | p191 >= baseline_start_date) %>% filter(!is.na(baseline_start_date)),
    miss = two_ques %>% filter(!is.na(baseline_start_date)),
    one_ques_excluded = anti_join(.full, one_ques, by = "id"),
    two_ques_excluded = anti_join(one_ques, two_ques, by = "id"),
    liver_excluded = anti_join(two_ques, liver, by = "id"),
    l2fu_excluded = anti_join(two_ques, l2fu, by = "id"),
    miss_excluded = anti_join(two_ques, miss, by = "id")
  ) %>%
  cohort_label(
    one_ques = "One or more 24-hour recall",
    one_ques_excluded = "No Oxford WebQ",
    two_ques = "Two or more Oxford WebQ",
    two_ques_excluded = "One Oxford WebQ",
    liver_excluded = "Liver cancer diagnosis before start of follow-up",
    l2fu_excluded = "Lost to follow-up before baseline",
    both = "Included in study",
    miss_excluded = "Missing diet data"
  )

flowchart <- ready_flowchart %>%
  consort_box_add(
    "full", 0, 50, cohort_count_adorn(ready_flowchart, .full)
  ) %>%
  consort_box_add(
    "first_exclusion", 10, 40, glue::glue(
      '
      {cohort_count_adorn(ready_flowchart, one_ques_excluded)}<br>
      {cohort_count_adorn(ready_flowchart, two_ques_excluded)}<br>
      ')
  ) %>%
  consort_box_add(
    "two_ques_box", 0, 30, cohort_count_adorn(ready_flowchart, two_ques)
  ) %>%
  consort_arrow_add(
    end = "first_exclusion", end_side = "left", start_x = 0, start_y = 40
  ) %>%
  consort_arrow_add(
    "full", "bottom", "two_ques_box", "top"
  ) %>%
  consort_box_add(
    "second_exclusion", 10, 20, glue::glue(
      '{cohort_count_adorn(ready_flowchart, liver_excluded)}<br>
      {cohort_count_adorn(ready_flowchart, l2fu_excluded)}<br>
      {cohort_count_adorn(ready_flowchart, miss_excluded)}<br>
      ')
  ) %>%
  consort_arrow_add(
    end = "second_exclusion", end_side = "left", start_x = 0, start_y = 20
  ) %>%
  consort_box_add(
    "included_cohort", 0, 10, cohort_count_adorn(ready_flowchart, both)
  ) %>%
  consort_arrow_add(
    "two_ques_box", "bottom", "included_cohort", "top"
  )

flowchart %>%
  ggplot() +
  geom_consort() +
  theme_consort(margin_h = 20, margin_v = 1)
  # ggtext::geom_richtext(
  #   aes(x = -40, y = 40, label = "Oxford WebQ was administered to:<br>~ 70,000 participants at initial assessment visit<br>~ 320,000 participants via e-mail")
  # )
```

# Supplemental Material

![Figure 1. Directed acyclic graph visualizing the relationship between
the exposure, replacing meat with legumes, and the outcome, liver
cancer. Red circles indicate ancestors of exposure and outcome with red
arrows being biasing paths. The NAFLD circle is blue to indicate that it
is an ancestor of the outcome. The green arrows are causal
paths.](Images/DAG.png)

```{r food table new}
id <- data.frame(id = 1:25)

food_group <- c(
  "Legumes", "Red meat", "Processed meat",
  "Animal-based foods", "Poultry", "Fish", "Dairy", "Eggs", "Sauces", "Mixed dishes", "Healthy plant-based foods",
  "Whole grains", "Fruits", "Nuts", "Plant oils", "Beverages", "Vegetables",
  "Unhealthy plant-based foods", "Refined cereals",
  "Potatoes", "Fruit juice", "Mixed dishes, vegetarian", "Sweets & snacks",
  "Sugar sweetened beverages", "Alcoholic beverages"
)
food_group_df <- data.frame(food_group)

includes <- c(
  "Soya-based desserts, Baked beans, pulses, Soya drinks (including calcium fortified),
  Tofu-based products, Hummus, Peas",
  
  "Beef, Lamb, Other meat including offal, Pork",
  
  "Sausages, bacon (with and without fat), ham, liver pate",
  
  " ",
  
  "Fried poultry with batter/breadcrumbs, Poultry (with/without skin)",
  
  "Fried fish with batter/breadcrumbs, Oily fish, including salmon, Prawns, lobster, crab, shellfish,
  Tinned tuna, white fish, other fish",
  
  "Spreadable/lower fat butter, dairy-based very low fat spread, Spreadable normal fat butter, dairy-based normal fat spread (including cholesterol lowering spread),
  Ice cream, milk puddings, milk-based desserts, cheesecake, Dairy-based smoothies, milk-based drinks, hot chocolate,
  Whole milk yogurt (plain), Cheese >17.5 g fat per 100 g, including hard cheese, soft cheese, spreadable, Blue, Feta, Mozzarella, Goats, other),
  Fat free and lower fat yogurt, plain or flavoured, Cheese <=17.5g fat per 100 g, including hard and spreadable lower fat cheese, Cottage,
  Semi-skimmed milk >1 g fat per 100 g (cow, other), Skimmed milk <1 g fat per 100 g (cow, cholesterol lowering, powdered),
  Whole milk >3.6 g fat per 100 g (cow, goat, sheep), Cream (cow's milk)",
  
  "Whole eggs and processed (omelette, scotch eggs, other)",
  
  "Mayonnaise, salad dressing, pesto, cheese sauce, white sauce, gravy, Yeast, chutney, olives, ketchup, brown sauce, tomato sauce",

  "Pizza (including gluten free crust), Crisps, savoury biscuits, cheese snacks, other savoury biscuits,
  Soups, homemade, powdered and canned, Sushi",
  
  " ",
  
  "Mixed, brown or seeded bread, sliced, baguette, bap, roll, Wholemeal bread, sliced, baguette, bap, roll,
  Wholewheat biscuit cereal, Bran cereal, Porridge oats (including milk/dried fruit added),
  Oatcrunch breakfast cereal, Muesli (with or without dried fruit), Brown and wholemeal pasta and rice",
  
  "Apples and pears, Blackberries, strawberries, blueberries, raspberries, cherries, Grapefruit, orange, satsuma,
  Dried fruit, prunes, Bananas, mixed fruit, grapes, mango, melon, peach, pineapple, kiwi, other, Stewed fruit, plums",
  
  "Peanut-butter and chocolate-based spread, Unsalted peanuts and nuts, Salted peanuts and nuts",
  
  "Olive oil, Olive oil based lower fat spread, plant-based lower fat margarine and soya-based lower fat spread (including cholesterol lowering spread),
  Olive oil based spread, plant-based soft or hard margarine and soya-based spread (including cholesterol lowering spread)",
  
  "Normal instant, filter, cappuccino, espresso coffee, Decaffeinated instant, filter, cappuccino, espresso coffee,
  Black, green and other tea, Decaffeinated black, herbal tea, rooibos, Plain water, sparkling water",
  
  "Garlic, leek, onion, Broccoli, cabbage, kale, cauliflower, spinach, sprouts, Mixed side salad, lettuce, watercress,
  Beetroot, carrots, celery, parsnip, turnip, Fresh and tinned tomatoes,
  Mushrooms, mixed vegetables, avocado, broad beans, green beans, butternut squash, courgettes, peppers, other,
  Coleslaw, salad with added fat/mayonnaise, guacamole, sweetcorn",
  
  " ",
  
  "Chocolate biscuits, plain biscuits, sweet biscuits and cookies, Naan, garlic bread, other bread (including gluten free),
  White bread, sliced, baguette, bap, roll, Oatcrunch breakfast cereal, Crisps, savoury biscuits, cheese snacks, other savoury biscuits,
  White pasta, rice, couscous, gluten free pasta",
  
  "Potatoes, sweet potatoes, boiled or baked, Potatoes and chips, fried or roasted with fat, Potatoes, mashed",
  
  "Orange, grapefruit drink and 100% fruit juice",
  
  "Double and single crust pies, crumble pies, Yorkshire pudding, snackpot noodles,
  Indian samosa, pakora snacks, Quorn-based and vegetarian burgers and products",
  
  "Table sugar, honey, jam and preserves,
  Chocolate bar (including white, milk and dark chocolate), chocolate-covered raisins, chocolate-covered sweets,
  Pancakes, croissant, Danish pastries, scones, fruitcakes, cakes, doughnuts, sponge puddings, other desserts, cereal bars, sweet snacks,
  Hard and soft sweets (including sugar free)",
  
  "Rice and oat vegetable drinks, Low calorie fizzy drinks and squash, Fizzy sugary drinks, squash, fruit smoothies",
  
  "Beer and cider, Spirits and other alcoholic drinks, Fortified wine, Red and rose wine, White wine"
)

includes_df <- data.frame(includes)

df <- data.frame(food_group = food_group_df,
                 includes = includes)

bold_text <- c(1, 2, 3, 4, 11, 18, 25)
indent_text <- c(5, 6)
food_group_table <- df %>%
  gt() %>% 
  tab_caption(caption = md("**Supplementary table 1. Summary of included foods for each food group.**")) %>% 
  cols_label(
    food_group = md("**Food group**"),
    includes = md("**Includes**")
  ) |> 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = food_group,
      rows = bold_text
    )
  )

food_group_table
```

\newpage

```{r table legume quartiles}
table_legume <- tbl_merge(
  tbls = list(m1t_leg, m2t_leg)
  ) %>% 
  modify_spanning_header(everything() ~ NA_character_) %>% 
  modify_caption("**Supplementary table 3. No intake of legumes vs. quartiles of daily legume intake** (N = {N})") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
    modify_table_styling(
    columns = label,
    rows = label == "Legume category",
    footnote = "mean daily intake of legumes in grams for each quartile: Q1: 6.3, Q2: 15.7, Q3: 34.3, Q4 109."
  ) %>% 
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>% 
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_legume
```

```{r stratified on cancer type}
model1t_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2t_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

model1r_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2r_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

model1p_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_hcc
)

model2p_hcc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_hcc
)

m1t_hcc  <- model1t_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_hcc  <- model1r_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_hcc  <- model1p_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_hcc  <- model2t_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_hcc  <- model2r_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_hcc  <- model2p_hcc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

model1t_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2t_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

model1r_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2r_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

model1p_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_icc
)

model2p_icc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_icc
)

m1t_icc  <- model1t_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_icc  <- model1r_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_icc  <- model1p_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_icc  <- model2t_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_icc  <- model2r_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_icc  <- model2p_icc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_hcc, m2t_hcc)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_hcc, m2r_hcc))
row3 <- tbl_merge(list(m1p_hcc, m2p_hcc))
row4 <- tbl_merge(list(m1t_icc, m2t_icc))
row5 <- tbl_merge(list(m1r_icc, m2r_icc))
row6 <- tbl_merge(list(m1p_icc, m2p_icc))

table_cancer_type <-
  tbl_stack(list(row1, row2, row3, row4, row5, row6),
            group_header = c("Hepatocellular carcinoma", "Hepatocellular carcinoma", "Hepatocellular carcinoma", "Intrahepatic cholangiocarcinoma", "Intrahepatic cholangiocarcinoma", "Intrahepatic cholangiocarcinoma")) %>%
  modify_caption("**Supplementary table 2. substitution of total meat, red meat and processed meat with legumes and hazard ratios and 95% confidence intervals for hepatocellular carcinoma and intrahepatic cholangiocarcinoma.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
    ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
    ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_cancer_type
```

```{r exclusion of high alcohol consumers}
model1t_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2t_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)

model1r_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2r_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)

model1p_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_alc
)

model2p_alc <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_alc
)


m1t_alc <- model1t_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_alc <- model1r_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_alc <- model1p_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_alc <- model2t_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_alc <- model2r_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_alc <- model2p_alc %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_alc, m2t_alc)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_alc, m2r_alc))
row3 <- tbl_merge(list(m1p_alc, m2p_alc))

table_alc <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 3. Exclusion of high alcohol consumers. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_alc
```

```{r exclusion of energy misreporters}
model1t_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2t_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

model1r_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2r_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

model1p_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_misreporter
)

model2p_misreporter <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_misreporter
)

m1t_misreporter <- model1t_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_misreporter <- model1r_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_misreporter <- model1p_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_misreporter <- model2t_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_misreporter <- model2r_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_misreporter <- model2p_misreporter %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_misreporter, m2t_misreporter)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_misreporter, m2r_misreporter))
row3 <- tbl_merge(list(m1p_misreporter, m2p_misreporter))

table_misreporter <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 4. Exclusion of food intake misreporters. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_misreporter
```

```{r 3 or more compled diet questionnaires}
model1t_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2t_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

model1r_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2r_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + proc_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

model1p_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily,
  data = data_3_ques_comp
)

model2p_3_ques_comp <- coxph(
  Surv(time = status_age, event = status == "Liver cancer") ~
    legume_daily_15 + red_meat_daily_15 +
    updi + hpdi + animal_foods + alc_beverage_daily + total_weight_food_daily +
    sex +
    education + tdi + spouse +
    exercise + smoking_pack + alcohol_daily +
    wc,
  data = data_3_ques_comp
)

m1t_3_ques_comp <- model1t_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m1r_3_ques_comp <- model1r_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m1p_3_ques_comp <- model1p_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

m2t_3_ques_comp <- model2t_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for total meat",
  )

m2r_3_ques_comp <- model2r_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for red meat",
  )

m2p_3_ques_comp <- model2p_3_ques_comp %>%
  tbl_regression(
    exponentiate = T,
    include = legume_daily_15,
    label = legume_daily_15 ~ "Legumes for processed meat",
  )

row1 <- tbl_merge(list(m1t_3_ques_comp, m2t_3_ques_comp)) %>%
  modify_spanning_header(everything() ~ NA_character_)
row2 <- tbl_merge(list(m1r_3_ques_comp, m2r_3_ques_comp))
row3 <- tbl_merge(list(m1p_3_ques_comp, m2p_3_ques_comp))

table_3_ques_comp <-
  tbl_stack(list(row1, row2, row3)) %>%
  modify_caption("**Supplementary table 5. Participant who completed three or more diet questionnaires. Hazard ratios for substitution of legumes for total meat, red meat and processed meat.** (N = {N})") %>%
  modify_header(label = "**15 g/day substitution**") %>%
  modify_footnote(update = everything() ~ NA, abbreviation = T) %>%
  modify_table_styling(
    column = c(p.value_1, p.value_2),
    hide = TRUE
    ) %>% 
  as_gt() %>%
  tab_spanner(
    label = "Crude",
    columns = c(estimate_1, ci_1, p.value_1)
  ) %>%
  tab_spanner(
    label = "Adjusted",
    columns = c(estimate_2, ci_2, p.value_2)
  ) %>%
  tab_footnote(
    footnote = "Adjusted for age (as underlying timescale), other food groups and total food intake to fit the substitution model.",
    locations = cells_column_spanners(spanners = "Crude")
  ) %>%
  tab_footnote(
    footnote = "Further adjusted for sex, educational level, Townsend Deprivation Index, living alone, physical activity, smoking, alcohol intake and waist circumference.",
    locations = cells_column_spanners(spanners = "Adjusted")
  )
table_3_ques_comp
```
